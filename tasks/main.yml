---
- name: Make sure x is installed
  package: name="@base-x" state=present
- name: Install dm
  package: name="{{ item.1 }}" state=present
  when: item.0.name == mydm
  with_subelements:
    - "{{ dms }}"
    - packages
- name: Remove all other packages
  package: name="{{ item.1 }}" state=absent
  when: item.0.name != mydm
  with_subelements:
    - "{{ dms }}"
    - packages
- name: configurate dm
  template:
    src: "templates/{{item.1.file}}.j2"
    dest: "{{item.1.path}}"
  when: item.0.name == mydm
  with_subelements:
    - "{{ dms }}"
    - config
- name: Copy ressources
  copy:
    src: "{{item.file}}"
    dest: "{{item.path}}"
  with_items:
    - "{{ressources}}"
- name: Del. display-manager.service 
  file: path=/etc/systemd/system/display-manager.service state=absent
- name: install new display manager
  shell: "systemctl enable {{ mydm }}"
- name: Set graphical target
  shell: 'systemctl set-default graphical'
- name: restart display-manager always
  systemd: name="{{mydm}}" state=restarted
